# 🤖 自动评估功能说明

## 📋 功能概述

自动评估功能允许您在学生提交案例后，自动触发AI评估，无需手动点击评估按钮。

---

## 🎯 两种评估模式

### 模式1：**手动评估**（默认，推荐）

**工作流程**：
1. 学生提交案例 → 保存到数据库
2. HR访问 `case-evaluation-ai.html` 页面
3. 选择案例 → 点击"开始AI智能评估"
4. 查看结果 → 点击"保存评估结果到数据库"

✅ **优点**：
- 💰 **节省成本**：只评估需要的案例
- 🎯 **质量可控**：可以先筛选明显不合格的提交
- 🔄 **灵活调整**：可以重新评估
- 🛡️ **防止滥用**：避免恶意刷量

❌ **缺点**：
- 需要手动操作

---

### 模式2：**自动评估**（可选）

**工作流程**：
1. 学生提交案例 → 保存到数据库
2. **系统自动前置检查**（免费）
   - 检查链接有效性
   - 检查内容长度
   - 检查黑名单关键词
3. **通过检查** → 自动触发AI评估
4. **评估完成** → 自动保存结果

✅ **优点**：
- ⚡ **全自动**：无需人工介入
- 🚀 **实时反馈**：学生立即看到结果
- 📊 **效率高**：适合大量提交

❌ **缺点**：
- 💸 **成本较高**：每个提交都调用API
- 🐛 **可能被滥用**：测试提交也会评估
- ⚠️ **错误风险**：网络问题可能导致失败

---

## ⚙️ 如何配置

### 1. 打开设置页面
访问：`http://localhost:8888/auto-evaluation-settings.html`

或在线版本：
`https://你的域名/auto-evaluation-settings.html`

### 2. 配置主开关

**关闭自动评估**（默认）：
- 案例提交后不会自动评估
- 需要在评估页面手动触发

**开启自动评估**：
- 符合条件的案例会自动评估
- 不符合条件的案例仍需手动评估

### 3. 配置前置检查规则

**作用**：过滤低质量提交，减少不必要的API调用

**推荐设置**：
```
✅ 产品链接最小长度: 20
✅ AI提示词最小字数: 300（提高质量门槛）
✅ 产品说明最小字数: 500（确保有足够评估依据）
✅ 必须提供演示视频: 否（可选）
✅ 必须提交说明文档: 否（可选）
✅ 黑名单关键词: test,测试,demo,示例
```

### 4. 配置评估策略

**推荐设置**：
```
✅ 评估延迟: 5秒（防止重复提交）
✅ 失败重试次数: 2次
✅ 重试间隔: 3秒
```

---

## 💡 推荐方案

### 方案A：**纯手动评估**（最省钱）

**适用场景**：
- 提交量不大（每天 < 10个）
- 预算有限
- 需要严格控制质量

**配置**：
- ❌ 关闭自动评估
- ✅ 使用 `case-evaluation-ai.html` 手动评估

**成本**：
- ￥0.01-0.02 × 实际评估数量

---

### 方案B：**混合方案**（推荐）

**适用场景**：
- 大部分时间手动评估
- 招聘高峰期开启自动评估
- 需要灵活控制

**配置**：
1. **平时**：关闭自动评估
2. **高峰期**（如校招季）：
   - 开启自动评估
   - 设置严格的前置检查
   - 过滤90%的低质量提交

**成本**：
- 平时：￥0.01-0.02 × 实际评估数量
- 高峰期：￥0.01-0.02 × 通过前置检查的数量

---

### 方案C：**全自动评估**（最方便）

**适用场景**：
- 提交量大（每天 > 50个）
- 预算充足
- 追求效率和体验

**配置**：
- ✅ 开启自动评估
- ✅ 设置严格的前置检查：
  - 提示词 ≥ 300字
  - 产品说明 ≥ 500字
  - 启用黑名单

**成本**：
- ￥0.01-0.02 × 通过前置检查的数量
- 假设通过率30%：100个提交 → 30次评估 → ￥0.3-0.6

---

## 📊 成本估算

### 单次评估成本
- 智谱AI GLM-4-Flash：￥0.01-0.02/次
- 新用户免费额度：约可评估 500-1000次

### 月度成本估算

| 每日提交量 | 通过率 | 每日评估次数 | 每月成本 |
|-----------|-------|------------|---------|
| 10个 | 50% | 5次 | ￥1.5-3 |
| 50个 | 30% | 15次 | ￥9-18 |
| 100个 | 30% | 30次 | ￥18-36 |
| 200个 | 20% | 40次 | ￥24-48 |

**结论**：即使全自动评估，成本也非常低廉。

---

## 🛠️ 技术实现

### 前置检查逻辑（免费，本地执行）

```javascript
function passPreChecks(caseData) {
    const issues = [];
    
    // 1. 检查链接长度
    if (caseData.product_url.length < 20) {
        issues.push('产品链接过短');
    }
    
    // 2. 检查黑名单关键词
    const text = (caseData.prompts + caseData.summary).toLowerCase();
    if (text.includes('test') || text.includes('测试')) {
        issues.push('包含测试关键词');
    }
    
    // 3. 检查内容长度
    if (caseData.prompts.length < 300) {
        issues.push('提示词过短');
    }
    
    if (caseData.summary.length < 500) {
        issues.push('产品说明过短');
    }
    
    return issues.length === 0;
}
```

### 自动评估流程

```
提交案例
    ↓
前置检查（免费）
    ↓
✅ 通过 → 延迟5秒 → 调用AI评估（付费）→ 保存结果
❌ 不通过 → 标记为待审核 → 手动评估
```

---

## 🔒 安全机制

### 1. 防重复评估
- 同一案例在评估中时，拒绝重复请求
- 使用 `evaluating` 标志位控制

### 2. 失败重试
- 网络失败自动重试（最多2次）
- 重试间隔3秒

### 3. 黑名单过滤
- 自动拒绝包含测试关键词的提交
- 减少垃圾提交的成本

### 4. 评估延迟
- 提交后延迟5秒再评估
- 给用户反悔的机会

---

## 📝 使用建议

### 初期（测试阶段）
1. ❌ **关闭自动评估**
2. ✅ 使用手动评估页面
3. ✅ 观察提交质量
4. ✅ 调整前置检查规则

### 中期（稳定运行）
1. ✅ **开启自动评估**
2. ✅ 设置严格的前置检查
3. ✅ 监控成本和质量
4. ✅ 根据反馈调整规则

### 长期（优化阶段）
1. ✅ 分析评估数据
2. ✅ 优化前置检查规则
3. ✅ 在高峰期和低峰期切换模式
4. ✅ 定期审查低分案例

---

## ❓ 常见问题

### Q1: 自动评估会不会浪费钱？
**A**: 不会。前置检查可以过滤掉90%的低质量提交，只有真正认真填写的案例才会触发AI评估。

### Q2: 可以随时关闭吗？
**A**: 可以。在设置页面随时切换开关，立即生效。

### Q3: 已经提交的案例会自动评估吗？
**A**: 不会。自动评估只对**开启后新提交**的案例生效。历史案例需要手动评估。

### Q4: 自动评估失败怎么办？
**A**: 系统会自动重试2次。如果仍然失败，案例会标记为待审核，可以手动重新评估。

### Q5: 学生能看到评估结果吗？
**A**: 当前版本不支持。评估结果保存在数据库中，只有HR在管理后台可见。未来版本可以添加学生查询功能。

---

## 🚀 下一步

1. **测试功能**：打开设置页面，尝试切换开关
2. **调整规则**：根据实际提交情况调整前置检查
3. **监控成本**：查看智谱AI控制台的使用情况
4. **收集反馈**：观察评估质量，持续优化

---

## 📞 技术支持

如有问题，请查看：
- `auto-evaluation-config.js` - 配置文件
- `auto-evaluator.js` - 核心逻辑
- `case-evaluation-ai.html` - 手动评估页面
- `case-admin.html` - 数据管理页面

---

**推荐方案**：保持默认的手动评估模式，这样既省钱又可控。只在真正需要时才开启自动评估。
