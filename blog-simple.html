<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ - Eunice</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="blog-style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">Eunice</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="blog.html" class="nav-link active">åšå®¢</a></li>
            </ul>
        </div>
    </nav>

    <!-- åšå®¢å¤´éƒ¨ -->
    <header class="blog-header">
        <h1>æˆ‘çš„åšå®¢</h1>
        <p>åˆ†äº«å…³äºäººæ‰æ‹›è˜ã€èŒä¸šå‘å±•å’Œç”Ÿæ´»çš„æ€è€ƒ</p>
    </header>

    <!-- åšå®¢æ–‡ç« åˆ—è¡¨ -->
    <main class="blog-main">
        <div class="blog-container">
            <div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>
        </div>
    </main>

    <!-- åº•éƒ¨ -->
    <footer>
        <h3>è”ç³»æˆ‘</h3>
        <div class="contact">
            <p>ğŸ“§ é‚®ç®±ï¼šeunice@tencent.com</p>
            <p>ğŸ“± å¾®ä¿¡ï¼šè¯·é€šè¿‡é‚®ä»¶è·å–</p>
            <p>ğŸ’¼ LinkedInï¼šlinkedin.com/in/eunice-liu</p>
        </div>
        <p class="copyright">&copy; 2025 Eunice. All rights reserved.</p>
    </footer>

    <!-- å¼•å…¥Supabaseå®¢æˆ·ç«¯åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ========== Supabaseé…ç½® ==========
        const SUPABASE_URL = 'https://gevvmjwjmpjhwczfuiru.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdldnZtandqbXBqaHdjemZ1aXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTkyOTYsImV4cCI6MjA4MTc5NTI5Nn0.iA0eIjnudgmYHsVE_ioHTR8fR84oIciQqqNcbSBZ33I'

        // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
        let supabaseClient = null

        // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
        function initSupabase() {
            if (!supabaseClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
            }
            return supabaseClient
        }

        // ========== æ•°æ®åº“æ“ä½œå‡½æ•° ==========
        
        // è·å–æ‰€æœ‰æ–‡ç« åˆ—è¡¨
        async function getArticles(limit = 100) {
            try {
                console.log('ğŸ“¡ æ­£åœ¨æŸ¥è¯¢æ–‡ç« ...')
                const supabase = initSupabase()
                const { data, error } = await supabase
                    .from('articles')
                    .select('id, title, category, excerpt, created_at, slug')
                    .eq('published', true)
                    .order('created_at', { ascending: false })
                    .limit(limit)

                if (error) {
                    console.error('âŒ æŸ¥è¯¢å¤±è´¥:', error)
                    return []
                }

                console.log('âœ“ æˆåŠŸè·å–', data ? data.length : 0, 'ç¯‡æ–‡ç« ')
                return data || []
            } catch (err) {
                console.error('âŒ å¼‚å¸¸:', err)
                return []
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            const date = new Date(dateString)
            const year = date.getFullYear()
            const month = String(date.getMonth() + 1).padStart(2, '0')
            const day = String(date.getDate()).padStart(2, '0')
            return `${year}-${month}-${day}`
        }

        // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
        function renderArticleList(articles, containerId = 'blog-container') {
            const container = document.querySelector(`.${containerId}`)
            if (!container) {
                console.error('æœªæ‰¾åˆ°å®¹å™¨:', containerId)
                return
            }

            if (!articles || articles.length === 0) {
                container.innerHTML = '<p class="no-articles">æš‚æ— æ–‡ç« </p>'
                return
            }

            const articlesHTML = articles.map(article => `
                <article class="blog-card">
                    <div class="blog-meta">
                        <span class="blog-date">ğŸ“… ${formatDate(article.created_at)}</span>
                        <span class="blog-category">${article.category || 'æœªåˆ†ç±»'}</span>
                    </div>
                    <h2 class="blog-title">
                        <a href="article-detail.html?id=${article.id}">${article.title}</a>
                    </h2>
                    <p class="blog-excerpt">
                        ${article.excerpt || ''}
                    </p>
                    <a href="article-detail.html?id=${article.id}" class="read-more">é˜…è¯»å…¨æ–‡ â†’</a>
                </article>
            `).join('')

            container.innerHTML = articlesHTML
        }

        // ========== é¡µé¢åŠ è½½é€»è¾‘ ==========
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ')
            
            // æ£€æŸ¥Supabaseåº“
            if (typeof window.supabase === 'undefined') {
                console.error('âŒ Supabaseåº“æœªåŠ è½½')
                document.querySelector('.blog-container').innerHTML = 
                    '<p class="error">Supabaseåº“åŠ è½½å¤±è´¥</p>'
                return
            }
            console.log('âœ“ Supabaseåº“å·²åŠ è½½')
            
            try {
                const articles = await getArticles()
                console.log('ğŸ“Š æ–‡ç« æ•°é‡:', articles.length)
                renderArticleList(articles, 'blog-container')
                console.log('âœ“ æ¸²æŸ“å®Œæˆ')
            } catch (error) {
                console.error('âŒ åŠ è½½å¤±è´¥:', error)
                document.querySelector('.blog-container').innerHTML = 
                    '<p class="error">åŠ è½½æ–‡ç« å¤±è´¥: ' + error.message + '</p>'
            }
        })
    </script>
</body>
</html>
