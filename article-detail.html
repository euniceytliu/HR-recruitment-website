<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« è¯¦æƒ… - Eunice</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="article-style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">Eunice</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="blog.html" class="nav-link active">åšå®¢</a></li>
            </ul>
        </div>
    </nav>

    <!-- æ–‡ç« å†…å®¹ -->
    <main>
        <div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>
    </main>

    <!-- åº•éƒ¨ -->
    <footer>
        <h3>è”ç³»æˆ‘</h3>
        <div class="contact">
            <p>ğŸ“§ é‚®ç®±:eunice@tencent.com</p>
            <p>ğŸ“± å¾®ä¿¡:è¯·é€šè¿‡é‚®ä»¶è·å–</p>
            <p>ğŸ’¼ LinkedIn:linkedin.com/in/eunice-liu</p>
        </div>
        <p class="copyright">&copy; 2025 Eunice. All rights reserved.</p>
    </footer>

    <!-- å¼•å…¥Supabaseå®¢æˆ·ç«¯åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ========== Supabaseé…ç½® ==========
        const SUPABASE_URL = 'https://gevvmjwjmpjhwczfuiru.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdldnZtandqbXBqaHdjemZ1aXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTkyOTYsImV4cCI6MjA4MTc5NTI5Nn0.iA0eIjnudgmYHsVE_ioHTR8fR84oIciQqqNcbSBZ33I'

        let supabaseClient = null

        function initSupabase() {
            if (!supabaseClient) {
                supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
            }
            return supabaseClient
        }

        // ========== æ•°æ®åº“æ“ä½œå‡½æ•° ==========
        
        async function getArticleById(id) {
            try {
                const supabase = initSupabase()
                const { data, error } = await supabase
                    .from('articles')
                    .select('*')
                    .eq('id', id)
                    .eq('published', true)
                    .single()

                if (error) {
                    console.error('è·å–æ–‡ç« è¯¦æƒ…å¤±è´¥:', error)
                    return null
                }

                return data
            } catch (err) {
                console.error('è·å–æ–‡ç« è¯¦æƒ…å¼‚å¸¸:', err)
                return null
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString)
            const year = date.getFullYear()
            const month = String(date.getMonth() + 1).padStart(2, '0')
            const day = String(date.getDate()).padStart(2, '0')
            return `${year}-${month}-${day}`
        }

        function renderArticleDetail(article) {
            if (!article) {
                document.querySelector('main').innerHTML = '<div class="error">æ–‡ç« æœªæ‰¾åˆ°</div>'
                return
            }

            document.title = `${article.title} - Eunice`

            const main = document.querySelector('main')
            if (main) {
                main.innerHTML = `
                    <article class="article-detail">
                        <header class="article-header">
                            <div class="article-meta">
                                <span class="article-date">ğŸ“… ${formatDate(article.created_at)}</span>
                                <span class="article-category">${article.category || 'æœªåˆ†ç±»'}</span>
                            </div>
                            <h1 class="article-title">${article.title}</h1>
                        </header>
                        <div class="article-content">
                            ${article.content}
                        </div>
                        <footer class="article-footer">
                            <a href="blog.html" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
                        </footer>
                    </article>
                `
            }
        }

        // ========== é¡µé¢åŠ è½½é€»è¾‘ ==========
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search)
            const articleId = urlParams.get('id')

            if (!articleId) {
                document.querySelector('main').innerHTML = '<div class="error">æœªæŒ‡å®šæ–‡ç« </div>'
                return
            }

            try {
                const article = await getArticleById(parseInt(articleId))
                if (article) {
                    renderArticleDetail(article)
                } else {
                    document.querySelector('main').innerHTML = '<div class="error">æ–‡ç« æœªæ‰¾åˆ°</div>'
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡ç« å¤±è´¥:', error)
                document.querySelector('main').innerHTML = '<div class="error">åŠ è½½æ–‡ç« å¤±è´¥</div>'
            }
        })
    </script>
</body>
</html>
