<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢è°ƒè¯•ç‰ˆ - Eunice</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="blog-style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            border: 2px solid #333;
            padding: 15px;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 9999;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            font-size: 12px;
        }
        .debug-panel h3 {
            margin-top: 0;
            color: #333;
        }
        .debug-log {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ccc;
        }
        .debug-log.success { border-color: #28a745; color: #28a745; }
        .debug-log.error { border-color: #dc3545; color: #dc3545; }
        .debug-log.info { border-color: #17a2b8; color: #17a2b8; }
        .debug-log.warn { border-color: #ffc107; color: #856404; }
        .close-debug {
            float: right;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•é¢æ¿ -->
    <div class="debug-panel" id="debugPanel">
        <span class="close-debug" onclick="document.getElementById('debugPanel').style.display='none'">Ã—</span>
        <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
        <div id="debugLogs"></div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">Eunice</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="blog.html" class="nav-link active">åšå®¢</a></li>
            </ul>
        </div>
    </nav>

    <!-- åšå®¢å¤´éƒ¨ -->
    <header class="blog-header">
        <h1>æˆ‘çš„åšå®¢ï¼ˆè°ƒè¯•ç‰ˆï¼‰</h1>
        <p>åˆ†äº«å…³äºäººæ‰æ‹›è˜ã€èŒä¸šå‘å±•å’Œç”Ÿæ´»çš„æ€è€ƒ</p>
    </header>

    <!-- åšå®¢æ–‡ç« åˆ—è¡¨ -->
    <main class="blog-main">
        <div class="blog-container">
            <div class="loading">æ­£åœ¨åŠ è½½æ–‡ç« ...</div>
        </div>
    </main>

    <!-- åº•éƒ¨ -->
    <footer>
        <h3>è”ç³»æˆ‘</h3>
        <div class="contact">
            <p>ğŸ“§ é‚®ç®±ï¼šeunice@tencent.com</p>
            <p>ğŸ“± å¾®ä¿¡ï¼šè¯·é€šè¿‡é‚®ä»¶è·å–</p>
            <p>ğŸ’¼ LinkedInï¼šlinkedin.com/in/eunice-liu</p>
        </div>
        <p class="copyright">&copy; 2025 Eunice. All rights reserved.</p>
    </footer>

    <!-- å¼•å…¥Supabaseå®¢æˆ·ç«¯åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- å¼•å…¥é…ç½®æ–‡ä»¶ -->
    <script src="supabase-config.js"></script>
    <!-- å¼•å…¥æ•°æ®åº“æ“ä½œå‡½æ•° -->
    <script src="db-operations.js"></script>
    
    <script>
        // è‡ªå®šä¹‰æ—¥å¿—å‡½æ•°ï¼ŒåŒæ—¶æ˜¾ç¤ºåœ¨é¡µé¢å’Œæ§åˆ¶å°
        function debugLog(message, type = 'info') {
            const logsContainer = document.getElementById('debugLogs');
            const logDiv = document.createElement('div');
            logDiv.className = `debug-log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> ${message}`;
            logsContainer.appendChild(logDiv);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
            console.log(message);
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ–‡ç« åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', async function() {
            debugLog('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...', 'info');
            
            // æ£€æŸ¥Supabaseåº“æ˜¯å¦åŠ è½½
            if (typeof window.supabase === 'undefined') {
                debugLog('âŒ Supabaseåº“æœªåŠ è½½ï¼CDNå¯èƒ½è¢«å±è”½', 'error');
                document.querySelector('.blog-container').innerHTML = 
                    '<p class="error">Supabaseåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–CDNè®¿é—®</p>';
                return;
            }
            debugLog('âœ“ Supabaseåº“å·²æˆåŠŸåŠ è½½', 'success');
            
            // æ£€æŸ¥é…ç½®æ–‡ä»¶
            if (typeof initSupabase === 'undefined') {
                debugLog('âŒ supabase-config.jsæœªåŠ è½½ï¼', 'error');
                document.querySelector('.blog-container').innerHTML = 
                    '<p class="error">é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥</p>';
                return;
            }
            debugLog('âœ“ é…ç½®æ–‡ä»¶å·²åŠ è½½', 'success');
            
            // æ£€æŸ¥æ•°æ®åº“æ“ä½œå‡½æ•°
            if (typeof getArticles === 'undefined') {
                debugLog('âŒ db-operations.jsæœªåŠ è½½ï¼', 'error');
                document.querySelector('.blog-container').innerHTML = 
                    '<p class="error">æ•°æ®åº“æ“ä½œæ–‡ä»¶åŠ è½½å¤±è´¥</p>';
                return;
            }
            debugLog('âœ“ æ•°æ®åº“æ“ä½œå‡½æ•°å·²åŠ è½½', 'success');
            
            try {
                debugLog('ğŸ“¡ æ­£åœ¨åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯...', 'info');
                const supabase = initSupabase();
                debugLog('âœ“ Supabaseå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ', 'success');
                
                debugLog('ğŸ“¡ æ­£åœ¨ä»æ•°æ®åº“æŸ¥è¯¢æ–‡ç« ...', 'info');
                const { data, error } = await supabase
                    .from('articles')
                    .select('id, title, category, excerpt, created_at, slug')
                    .eq('published', true)
                    .order('created_at', { ascending: false });
                
                if (error) {
                    debugLog(`âŒ æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: ${error.message}`, 'error');
                    debugLog(`é”™è¯¯ä»£ç : ${error.code}`, 'error');
                    debugLog(`é”™è¯¯è¯¦æƒ…: ${JSON.stringify(error)}`, 'error');
                    document.querySelector('.blog-container').innerHTML = 
                        `<p class="error">æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: ${error.message}<br>é”™è¯¯ä»£ç : ${error.code}</p>`;
                    return;
                }
                
                debugLog(`âœ“ æŸ¥è¯¢æˆåŠŸï¼è·å–åˆ° ${data ? data.length : 0} ç¯‡æ–‡ç« `, 'success');
                
                if (!data || data.length === 0) {
                    debugLog('âš ï¸ æ•°æ®åº“è¿”å›ç©ºç»“æœï¼Œå¯èƒ½åŸå› ï¼š', 'warn');
                    debugLog('  1. RLSç­–ç•¥æœªæ­£ç¡®é…ç½®', 'warn');
                    debugLog('  2. æ•°æ®åº“ä¸­æ²¡æœ‰å·²å‘å¸ƒçš„æ–‡ç« ', 'warn');
                    debugLog('  3. APIå¯†é’¥æƒé™ä¸è¶³', 'warn');
                    document.querySelector('.blog-container').innerHTML = 
                        '<p class="no-articles">æš‚æ— æ–‡ç« ï¼ˆæ•°æ®åº“è¿”å›ç©ºç»“æœï¼‰</p>';
                    return;
                }
                
                debugLog(`ğŸ“„ æ–‡ç« æ ‡é¢˜: ${data.map(a => a.title).join(', ')}`, 'info');
                
                // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
                debugLog('ğŸ¨ å¼€å§‹æ¸²æŸ“æ–‡ç« åˆ—è¡¨...', 'info');
                renderArticleList(data, 'blog-container');
                debugLog('âœ“ æ–‡ç« åˆ—è¡¨æ¸²æŸ“å®Œæˆï¼', 'success');
                
            } catch (error) {
                debugLog(`âŒ å‘ç”Ÿå¼‚å¸¸: ${error.message}`, 'error');
                debugLog(`å¼‚å¸¸å †æ ˆ: ${error.stack}`, 'error');
                document.querySelector('.blog-container').innerHTML = 
                    `<p class="error">åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
