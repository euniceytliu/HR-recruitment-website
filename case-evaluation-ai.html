<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹æ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ - è…¾è®¯HR</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="zhipu-api-config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .api-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }

        .api-connected {
            background: #f0fff4;
            color: #22543d;
        }

        .api-disconnected {
            background: #fff5f5;
            color: #742a2a;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .sidebar h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .case-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .case-item {
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .case-item:hover {
            background: #f7fafc;
            border-color: #667eea;
        }

        .case-item.selected {
            background: #ebf8ff;
            border-color: #667eea;
        }

        .case-item .name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .case-item .info {
            font-size: 12px;
            color: #718096;
        }

        .case-item .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-top: 5px;
        }

        .status-pending {
            background: #fef5e7;
            color: #d68910;
        }

        .status-evaluated {
            background: #f0fff4;
            color: #22543d;
        }

        .content-area {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .case-detail {
            margin-bottom: 30px;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .detail-value {
            color: #4a5568;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .link {
            color: #667eea;
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        .evaluate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .evaluate-btn:hover {
            transform: translateY(-2px);
        }

        .evaluate-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .evaluation-result {
            background: #f7fafc;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
        }

        .score-display {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .score-number {
            font-size: 72px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .score-label {
            color: #718096;
            margin-top: 10px;
            font-size: 14px;
        }

        .evaluation-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .evaluation-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .evaluation-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .evaluation-item .label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .evaluation-item .score {
            color: #667eea;
            font-weight: 600;
        }

        .evaluation-item .comment {
            color: #4a5568;
            line-height: 1.6;
            margin-top: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .save-btn {
            width: 100%;
            padding: 12px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }

        .save-btn:hover {
            background: #38a169;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ¤– æ¡ˆä¾‹æ™ºèƒ½è¯„ä¼°ç³»ç»Ÿ</h1>
            <p style="color: #718096; margin-top: 5px;">åŸºäºè…¾è®¯HRè¯„ä¼°æ ‡å‡†çš„AIè‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿ</p>
            <div class="api-status" id="apiStatus">
                <span>â³ æ£€æµ‹AIé…ç½®ä¸­...</span>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- å·¦ä¾§æ¡ˆä¾‹åˆ—è¡¨ -->
            <div class="sidebar">
                <h3>ğŸ“‹ å¾…è¯„ä¼°æ¡ˆä¾‹</h3>
                <div id="caseList" class="case-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>åŠ è½½æ¡ˆä¾‹ä¸­...</p>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§è¯¦æƒ…å’Œè¯„ä¼°åŒº -->
            <div class="content-area">
                <div id="emptyState" class="empty-state">
                    <h3>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©è¦è¯„ä¼°çš„æ¡ˆä¾‹</h3>
                    <p>ç³»ç»Ÿå°†è‡ªåŠ¨åˆ†ææ¡ˆä¾‹å¹¶ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š</p>
                </div>

                <div id="detailArea" style="display: none;">
                    <button class="evaluate-btn" id="evaluateBtn">
                        ğŸš€ å¼€å§‹AIæ™ºèƒ½è¯„ä¼°
                    </button>

                    <div class="case-detail" id="caseDetail"></div>

                    <div id="evaluationResult" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabaseé…ç½®
        const SUPABASE_URL = 'https://gevvmjwjmpjhwczfuiru.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdldnZtandqbXBqaHdjemZ1aXJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMTkyOTYsImV4cCI6MjA4MTc5NTI5Nn0.iA0eIjnudgmYHsVE_ioHTR8fR84oIciQqqNcbSBZ33I';
        
        let caseSupabase;
        let allCases = [];
        let selectedCase = null;
        let hasAIConfig = false;

        // åˆå§‹åŒ–
        window.onload = async function() {
            // åˆ›å»ºSupabaseå®¢æˆ·ç«¯
            caseSupabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            checkAIConfig();
            await loadCases();
        };

        // æ£€æŸ¥AIé…ç½®
        function checkAIConfig() {
            const statusEl = document.getElementById('apiStatus');
            
            if (typeof ZHIPU_CONFIG !== 'undefined' && ZHIPU_CONFIG.apiKey && 
                !ZHIPU_CONFIG.apiKey.includes('your-api-key')) {
                hasAIConfig = true;
                statusEl.className = 'api-status api-connected';
                statusEl.innerHTML = 'âœ… AIè¯„ä¼°å·²å¯ç”¨ (æ™ºè°±AI)';
            } else {
                statusEl.className = 'api-status api-disconnected';
                statusEl.innerHTML = 'âš ï¸ æœªé…ç½®AI - è¯·é…ç½®zhipu-api-config.js';
            }
        }

        // åŠ è½½æ¡ˆä¾‹åˆ—è¡¨
        async function loadCases() {
            try {
                const { data, error } = await caseSupabase
                    .from('case_submissions')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allCases = data;
                renderCaseList(data);
            } catch (error) {
                console.error('åŠ è½½æ¡ˆä¾‹å¤±è´¥:', error);
                document.getElementById('caseList').innerHTML = 
                    '<div class="loading"><p style="color: #e53e3e;">åŠ è½½å¤±è´¥: ' + error.message + '</p></div>';
            }
        }

        // æ¸²æŸ“æ¡ˆä¾‹åˆ—è¡¨
        function renderCaseList(cases) {
            const listEl = document.getElementById('caseList');
            
            if (cases.length === 0) {
                listEl.innerHTML = '<div class="loading"><p>æš‚æ— æ¡ˆä¾‹æäº¤</p></div>';
                return;
            }

            listEl.innerHTML = cases.map(c => `
                <div class="case-item" onclick="selectCase(${c.id})">
                    <div class="name">${c.name}</div>
                    <div class="info">${c.school}</div>
                    <div class="info">${new Date(c.created_at).toLocaleDateString()}</div>
                    <span class="status-badge ${c.score ? 'status-evaluated' : 'status-pending'}">
                        ${c.score ? 'å·²è¯„ä¼° (' + c.score + 'åˆ†)' : 'å¾…è¯„ä¼°'}
                    </span>
                </div>
            `).join('');
        }

        // é€‰æ‹©æ¡ˆä¾‹
        function selectCase(id) {
            selectedCase = allCases.find(c => c.id === id);
            
            // æ›´æ–°åˆ—è¡¨é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.case-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // æ˜¾ç¤ºè¯¦æƒ…
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('detailArea').style.display = 'block';
            renderCaseDetail(selectedCase);
            
            // å¦‚æœå·²æœ‰è¯„ä¼°ç»“æœ,æ˜¾ç¤º
            if (selectedCase.score && selectedCase.feedback) {
                showSavedEvaluation(selectedCase);
            } else {
                document.getElementById('evaluationResult').style.display = 'none';
            }
        }

        // æ¸²æŸ“æ¡ˆä¾‹è¯¦æƒ…
        function renderCaseDetail(caseData) {
            const detailEl = document.getElementById('caseDetail');
            detailEl.innerHTML = `
                <h2 style="margin-bottom: 25px; color: #2d3748;">ğŸ“ æ¡ˆä¾‹è¯¦æƒ…</h2>
                
                <div class="detail-section">
                    <div class="detail-label">ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</div>
                    <div class="detail-value">
                        <strong>å§“åï¼š</strong>${caseData.name}<br>
                        <strong>å­¦æ ¡ï¼š</strong>${caseData.school}<br>
                        <strong>è”ç³»æ–¹å¼ï¼š</strong>${caseData.phone} / ${caseData.email}<br>
                        <strong>æäº¤æ—¶é—´ï¼š</strong>${new Date(caseData.created_at).toLocaleString('zh-CN')}
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">ğŸ¯ é€‰æ‹©çš„æ¡ˆä¾‹</div>
                    <div class="detail-value">${caseData.case_name}</div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">ğŸ”— äº§å“é“¾æ¥</div>
                    <div class="detail-value">
                        <a href="${caseData.product_url}" target="_blank" class="link">${caseData.product_url}</a>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">ğŸ¥ æ¼”ç¤ºè§†é¢‘</div>
                    <div class="detail-value">
                        <a href="${caseData.video_url}" target="_blank" class="link">${caseData.video_url}</a>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">ğŸ’¡ æ ¸å¿ƒAIæç¤ºè¯</div>
                    <div class="detail-value">${caseData.prompts}</div>
                </div>

                <div class="detail-section">
                    <div class="detail-label">ğŸ“Š äº§å“è¯´æ˜ä¸æµ‹è¯•ç»“æœ</div>
                    <div class="detail-value">${caseData.summary}</div>
                </div>

                ${caseData.document_url ? `
                <div class="detail-section">
                    <div class="detail-label">ğŸ“„ è¯´æ˜æ–‡æ¡£</div>
                    <div class="detail-value">${caseData.document_name || 'å·²ä¸Šä¼ '}</div>
                </div>
                ` : ''}
            `;
        }

        // å¼€å§‹è¯„ä¼°
        document.getElementById('evaluateBtn').addEventListener('click', async function() {
            if (!hasAIConfig) {
                alert('è¯·å…ˆé…ç½®AI API Keyï¼ˆzhipu-api-config.jsï¼‰');
                return;
            }

            if (!selectedCase) {
                alert('è¯·å…ˆé€‰æ‹©è¦è¯„ä¼°çš„æ¡ˆä¾‹');
                return;
            }

            const btn = this;
            btn.disabled = true;
            btn.textContent = 'ğŸ¤– AIè¯„ä¼°ä¸­ï¼Œè¯·ç¨å€™...';

            const resultEl = document.getElementById('evaluationResult');
            resultEl.style.display = 'block';
            resultEl.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>AIæ­£åœ¨åˆ†ææ¡ˆä¾‹ï¼Œé¢„è®¡éœ€è¦10-20ç§’...</p>
                </div>
            `;

            try {
                const evaluation = await evaluateCase(selectedCase);
                displayEvaluation(evaluation);
                btn.textContent = 'âœ… è¯„ä¼°å®Œæˆ';
            } catch (error) {
                console.error('è¯„ä¼°å¤±è´¥:', error);
                resultEl.innerHTML = `
                    <div class="loading">
                        <p style="color: #e53e3e;">âŒ è¯„ä¼°å¤±è´¥: ${error.message}</p>
                        <p style="font-size: 12px; margin-top: 10px;">è¯·æ£€æŸ¥AIé…ç½®æˆ–ç¨åé‡è¯•</p>
                    </div>
                `;
                btn.disabled = false;
                btn.textContent = 'ğŸš€ é‡æ–°è¯„ä¼°';
            }
        });

        // AIè¯„ä¼°å‡½æ•°
        async function evaluateCase(caseData) {
            // å‰ç½®æ£€æŸ¥ï¼šææ–™å®Œæ•´æ€§
            const checks = {
                hasValidUrl: caseData.product_url && caseData.product_url.length > 20 && !caseData.product_url.includes('test'),
                hasValidVideo: caseData.video_url && caseData.video_url.length > 20 && !caseData.video_url.includes('test'),
                hasValidPrompts: caseData.prompts && caseData.prompts.length > 100,
                hasValidSummary: caseData.summary && caseData.summary.length > 200,
                hasDocument: !!caseData.document_url
            };

            // è®¡ç®—ç¼ºå¤±ææ–™æ•°é‡
            const missingCount = Object.values(checks).filter(v => !v).length;
            
            // å¦‚æœå…³é”®ææ–™ç¼ºå¤±è¿‡å¤šï¼Œç›´æ¥è¿”å›ä½åˆ†
            if (missingCount >= 3) {
                return {
                    totalScore: 35 + (5 - missingCount) * 5,
                    dimensions: {
                        completeness: {
                            score: 5,
                            maxScore: 20,
                            comment: `ä¸¥é‡ç¼ºå¤±ææ–™ï¼š${!checks.hasValidUrl ? 'äº§å“é“¾æ¥æ— æ•ˆæˆ–ä¸ºæµ‹è¯•é“¾æ¥ï¼›' : ''}${!checks.hasValidVideo ? 'æ¼”ç¤ºè§†é¢‘é“¾æ¥æ— æ•ˆï¼›' : ''}${!checks.hasValidPrompts ? 'AIæç¤ºè¯è¿‡äºç®€å•ï¼ˆå°‘äº100å­—ï¼‰ï¼›' : ''}${!checks.hasValidSummary ? 'äº§å“è¯´æ˜è¿‡äºç®€å•ï¼ˆå°‘äº200å­—ï¼‰ï¼›' : ''}${!checks.hasDocument ? 'æœªæäº¤è¯´æ˜æ–‡æ¡£ã€‚' : ''}`
                        },
                        product: { score: 10, maxScore: 30, comment: "æ— æ³•éªŒè¯äº§å“åŠŸèƒ½ï¼Œæäº¤çš„é“¾æ¥æ— æ•ˆæˆ–ä¸ºæµ‹è¯•é“¾æ¥" },
                        aiCollaboration: { score: 8, maxScore: 25, comment: "æç¤ºè¯å†…å®¹è¿‡äºç®€å•ï¼Œæ— æ³•è¯„ä¼°AIååŒèƒ½åŠ›" },
                        delivery: { score: 5, maxScore: 15, comment: "æµ‹è¯•ææ–™ä¸å®Œæ•´ï¼Œæ— æ³•è¯„ä¼°äº¤ä»˜èƒ½åŠ›" },
                        learning: { score: 5, maxScore: 10, comment: "åˆ›æ–°æ€§å’Œå­¦ä¹ èƒ½åŠ›ä½“ç°ä¸è¶³" },
                        documentation: { score: 0, maxScore: 5, comment: "æ–‡æ¡£è´¨é‡ä¸è¶³" }
                    },
                    strengths: ["æäº¤äº†æ¡ˆä¾‹å°è¯•ï¼ˆåŸºç¡€åˆ†ï¼‰"],
                    improvements: [
                        "ã€è‡´å‘½é—®é¢˜ã€‘äº§å“é“¾æ¥æ— æ•ˆæˆ–ä¸ºæµ‹è¯•é“¾æ¥ï¼Œæ— æ³•éªŒè¯äº§å“æ˜¯å¦çœŸå®å¯ç”¨",
                        "ã€å…³é”®ç¼ºå¤±ã€‘ææ–™å®Œæ•´æ€§ä¸¥é‡ä¸è¶³ï¼Œç¼ºå°‘å¤šé¡¹å¿…è¦ææ–™",
                        "ã€å†…å®¹è´¨é‡ã€‘æäº¤å†…å®¹è¿‡äºç®€å•ï¼Œæœªè¾¾åˆ°è¯„ä¼°çš„æœ€ä½æ ‡å‡†"
                    ],
                    suggestions: [
                        "ã€ç«‹å³è¡ŒåŠ¨ã€‘è¯·æä¾›çœŸå®å¯è®¿é—®çš„äº§å“é“¾æ¥ï¼Œç¡®ä¿äº§å“å¯ä»¥æ­£å¸¸ä½¿ç”¨",
                        "ã€è¡¥å……ææ–™ã€‘å®Œå–„æ‰€æœ‰å¿…éœ€ææ–™ï¼šæœ‰æ•ˆçš„æ¼”ç¤ºè§†é¢‘ã€å®Œæ•´çš„AIæç¤ºè¯ï¼ˆè‡³å°‘300å­—ï¼‰ã€è¯¦ç»†çš„äº§å“è¯´æ˜ï¼ˆè‡³å°‘500å­—ï¼‰",
                        "ã€é‡æ–°æäº¤ã€‘å»ºè®®åœ¨å®Œå–„æ‰€æœ‰ææ–™åé‡æ–°æäº¤ï¼Œå½“å‰æäº¤ä¸ç¬¦åˆè¯„ä¼°è¦æ±‚"
                    ],
                    summary: "ææ–™ä¸¥é‡ä¸å®Œæ•´ï¼Œäº§å“é“¾æ¥æ— æ•ˆï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆè¯„ä¼°ï¼Œå»ºè®®è¡¥å……ææ–™åé‡æ–°æäº¤"
                };
            }

            const prompt = `ä½ æ˜¯è…¾è®¯HRçš„ä¸“ä¸šæ¡ˆä¾‹è¯„ä¼°ä¸“å®¶ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¯„ä¼°æ ‡å‡†å¯¹å­¦ç”Ÿæäº¤çš„æ¡ˆä¾‹è¿›è¡Œè¯„åˆ†ã€‚

âš ï¸ é‡è¦æé†’ï¼š
- ä½ æ— æ³•çœŸæ­£è®¿é—®é“¾æ¥ï¼Œåªèƒ½æ ¹æ®æ–‡å­—æè¿°è¯„ä¼°
- å¦‚æœæç¤ºè¯å†…å®¹è¿‡äºç®€å•ï¼ˆå¦‚"test"ã€"æµ‹è¯•"ç­‰ï¼‰ï¼Œå¿…é¡»å¤§å¹…æ‰£åˆ†
- å¦‚æœäº§å“è¯´æ˜ä¸è¯¦ç»†ï¼Œæ— æ³•åˆ¤æ–­åŠŸèƒ½è´¨é‡ï¼Œå¿…é¡»ç»™äºˆä½åˆ†
- è¯„åˆ†å¿…é¡»ä¸¥æ ¼ï¼Œå®å¯åä¸¥ä¸å¯åæ¾

# è¯„ä¼°æ ‡å‡†ï¼ˆæ€»åˆ†100åˆ†ï¼‰

## ä¸€ã€æäº¤ææ–™å®Œæ•´æ€§ï¼ˆ20åˆ†ï¼‰
- å¯è¿è¡Œçš„äº§å“ï¼š5åˆ†
- æ¼”ç¤ºè§†é¢‘ï¼š3åˆ†
- æ ¸å¿ƒAIæç¤ºè¯ï¼š4åˆ†
- æµ‹è¯•æ•°æ®ä¸ç»“æœï¼š4åˆ†
- è¯´æ˜æ–‡æ¡£ï¼š4åˆ†

## äºŒã€äº§å“åŠŸèƒ½ä¸è´¨é‡ï¼ˆ30åˆ†ï¼‰
- æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼š15åˆ†ï¼ˆä¼˜ç§€13-15ï¼Œè‰¯å¥½10-12ï¼ŒåŠæ ¼7-9ï¼‰
- AIæ•ˆæœè´¨é‡ï¼š15åˆ†ï¼ˆä¼˜ç§€13-15ï¼Œè‰¯å¥½10-12ï¼ŒåŠæ ¼7-9ï¼‰

## ä¸‰ã€AIååŒèƒ½åŠ›ï¼ˆ25åˆ†ï¼‰
- é—®é¢˜å®šä¹‰èƒ½åŠ›ï¼š8åˆ†ï¼ˆä¼˜ç§€7-8ï¼Œè‰¯å¥½5-6ï¼ŒåŠæ ¼3-4ï¼‰
- AIæç¤ºè¯è®¾è®¡ï¼š10åˆ†ï¼ˆæ˜ç¡®æ€§ã€ç»“æ„æ€§ã€è¿­ä»£ä¼˜åŒ–ï¼‰
- æ–¹æ¡ˆåˆ¤æ–­èƒ½åŠ›ï¼š7åˆ†ï¼ˆä¼˜ç§€6-7ï¼Œè‰¯å¥½4-5ï¼ŒåŠæ ¼2-3ï¼‰

## å››ã€å…¨æµç¨‹äº¤ä»˜èƒ½åŠ›ï¼ˆ15åˆ†ï¼‰
- ä»»åŠ¡æ‹†è§£ï¼š5åˆ†
- æµ‹è¯•éªŒè¯ï¼š5åˆ†
- é—®é¢˜è¯†åˆ«ä¸ä¼˜åŒ–ï¼š5åˆ†

## äº”ã€å­¦ä¹ èƒ½åŠ›ä¸åˆ›æ–°æ€§ï¼ˆ10åˆ†ï¼‰
- å¿«é€Ÿå­¦ä¹ èƒ½åŠ›ï¼š5åˆ†
- åˆ›æ–°æ€§ï¼š5åˆ†

## å…­ã€æ–‡æ¡£è´¨é‡ï¼ˆåŠ åˆ†é¡¹ï¼Œæœ€é«˜+5åˆ†ï¼‰
- æ–‡æ¡£ç»“æ„æ¸…æ™°ï¼š+2åˆ†
- ä¸°å¯Œçš„å¯è§†åŒ–ï¼š+2åˆ†
- é€»è¾‘ä¸¥å¯†ä¸“ä¸šï¼š+1åˆ†

---

# å­¦ç”Ÿæäº¤çš„æ¡ˆä¾‹ä¿¡æ¯

**æ¡ˆä¾‹åç§°ï¼š** ${caseData.case_name}

**äº§å“é“¾æ¥ï¼š** ${caseData.product_url}
âš ï¸ æ³¨æ„ï¼šä½ æ— æ³•è®¿é—®æ­¤é“¾æ¥ï¼Œåªèƒ½æ ¹æ®å…¶ä»–æ–‡å­—ä¿¡æ¯æ¨æ–­

**æ¼”ç¤ºè§†é¢‘ï¼š** ${caseData.video_url}
âš ï¸ æ³¨æ„ï¼šä½ æ— æ³•è§‚çœ‹è§†é¢‘ï¼Œåªèƒ½æ ¹æ®å…¶ä»–æ–‡å­—ä¿¡æ¯æ¨æ–­

**æ ¸å¿ƒAIæç¤ºè¯ï¼ˆå­—æ•°ï¼š${caseData.prompts.length}å­—ï¼‰ï¼š**
${caseData.prompts}
âš ï¸ å¦‚æœå†…å®¹è¿‡äºç®€å•ï¼ˆå¦‚"test"ã€å°‘äº50å­—ï¼‰ï¼Œå¿…é¡»åœ¨"æäº¤ææ–™å®Œæ•´æ€§"å’Œ"AIååŒèƒ½åŠ›"ç»´åº¦ä¸¥æ ¼æ‰£åˆ†

**äº§å“è¯´æ˜ä¸æµ‹è¯•ç»“æœï¼ˆå­—æ•°ï¼š${caseData.summary.length}å­—ï¼‰ï¼š**
${caseData.summary}
âš ï¸ å¦‚æœå†…å®¹è¿‡äºç®€å•ï¼ˆå°‘äº100å­—ï¼‰ï¼Œå¿…é¡»åœ¨"äº§å“åŠŸèƒ½ä¸è´¨é‡"å’Œ"å…¨æµç¨‹äº¤ä»˜èƒ½åŠ›"ç»´åº¦ä¸¥æ ¼æ‰£åˆ†

**æ˜¯å¦æäº¤è¯´æ˜æ–‡æ¡£ï¼š** ${caseData.document_url ? 'æ˜¯' : 'å¦'}

---

# ä¸¥æ ¼è¯„åˆ†è¦æ±‚

1. **å¦‚æœæç¤ºè¯å°‘äº50å­—æˆ–å†…å®¹ä¸ºæµ‹è¯•å†…å®¹** â†’ "AIååŒèƒ½åŠ›"ä¸è¶…è¿‡8åˆ†ï¼ˆæ»¡åˆ†25ï¼‰
2. **å¦‚æœäº§å“è¯´æ˜å°‘äº100å­—** â†’ "äº§å“åŠŸèƒ½ä¸è´¨é‡"ä¸è¶…è¿‡10åˆ†ï¼ˆæ»¡åˆ†30ï¼‰
3. **å¦‚æœé“¾æ¥æ˜æ˜¾ä¸ºæµ‹è¯•é“¾æ¥ï¼ˆå«testç­‰ï¼‰** â†’ "æäº¤ææ–™å®Œæ•´æ€§"ä¸è¶…è¿‡10åˆ†ï¼ˆæ»¡åˆ†20ï¼‰
4. **æ€»åˆ†å¿…é¡»åˆç†**ï¼šææ–™ä¸¥é‡ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œæ€»åˆ†ä¸åº”è¶…è¿‡50åˆ†

---

# è¯„ä¼°è¦æ±‚

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºè¯„ä¼°ç»“æœï¼Œä¸è¦è¾“å‡ºä»»ä½•å…¶ä»–å†…å®¹ï¼š

{
  "totalScore": 85,
  "dimensions": {
    "completeness": {
      "score": 18,
      "maxScore": 20,
      "comment": "å…·ä½“è¯„è¯­ï¼ŒæŒ‡å‡ºå¾—åˆ†å’Œæ‰£åˆ†åŸå› "
    },
    "product": {
      "score": 25,
      "maxScore": 30,
      "comment": "è¯„ä¼°æ ¸å¿ƒåŠŸèƒ½å’ŒAIæ•ˆæœ"
    },
    "aiCollaboration": {
      "score": 20,
      "maxScore": 25,
      "comment": "è¯„ä¼°é—®é¢˜å®šä¹‰ã€æç¤ºè¯è®¾è®¡ã€æ–¹æ¡ˆåˆ¤æ–­"
    },
    "delivery": {
      "score": 12,
      "maxScore": 15,
      "comment": "è¯„ä¼°ä»»åŠ¡æ‹†è§£ã€æµ‹è¯•éªŒè¯ã€é—®é¢˜ä¼˜åŒ–"
    },
    "learning": {
      "score": 8,
      "maxScore": 10,
      "comment": "è¯„ä¼°å­¦ä¹ èƒ½åŠ›å’Œåˆ›æ–°æ€§"
    },
    "documentation": {
      "score": 2,
      "maxScore": 5,
      "comment": "æ–‡æ¡£åŠ åˆ†é¡¹è¯„ä¼°"
    }
  },
  "strengths": [
    "ä¼˜åŠ¿1ï¼šå…·ä½“æè¿°",
    "ä¼˜åŠ¿2ï¼šå…·ä½“æè¿°",
    "ä¼˜åŠ¿3ï¼šå…·ä½“æè¿°"
  ],
  "improvements": [
    "ä¸è¶³1ï¼šå…·ä½“æè¿°å’Œæ”¹è¿›å»ºè®®",
    "ä¸è¶³2ï¼šå…·ä½“æè¿°å’Œæ”¹è¿›å»ºè®®",
    "ä¸è¶³3ï¼šå…·ä½“æè¿°å’Œæ”¹è¿›å»ºè®®"
  ],
  "suggestions": [
    "å»ºè®®1ï¼šå¯è½åœ°çš„å…·ä½“å»ºè®®",
    "å»ºè®®2ï¼šå¯è½åœ°çš„å…·ä½“å»ºè®®",
    "å»ºè®®3ï¼šå¯è½åœ°çš„å…·ä½“å»ºè®®"
  ],
  "summary": "ä¸€å¥è¯æ€»ç»“è¯„ä»·"
}

è¯·ä¸¥æ ¼æŒ‰ç…§è¯„åˆ†æ ‡å‡†æ‰“åˆ†ï¼Œå®¢è§‚å…¬æ­£ã€‚`;

            // è°ƒç”¨æ™ºè°±AI
            const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${ZHIPU_CONFIG.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: ZHIPU_CONFIG.model,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }],
                    temperature: 0.3,
                    max_tokens: 3000
                })
            });

            if (!response.ok) {
                throw new Error('AI APIè°ƒç”¨å¤±è´¥: ' + response.statusText);
            }

            const data = await response.json();
            const resultText = data.choices[0].message.content;
            
            // æå–JSON
            const jsonMatch = resultText.match(/\{[\s\S]*\}/);
            if (!jsonMatch) {
                throw new Error('AIè¿”å›æ ¼å¼é”™è¯¯');
            }

            return JSON.parse(jsonMatch[0]);
        }

        // å­˜å‚¨å½“å‰è¯„ä¼°ç»“æœï¼ˆç”¨äºä¿å­˜ï¼‰
        let currentEvaluation = null;

        // æ˜¾ç¤ºè¯„ä¼°ç»“æœ
        function displayEvaluation(evaluation) {
            currentEvaluation = evaluation; // ä¿å­˜åˆ°å…¨å±€å˜é‡
            const resultEl = document.getElementById('evaluationResult');
            
            const dimensionNames = {
                completeness: 'æäº¤ææ–™å®Œæ•´æ€§',
                product: 'äº§å“åŠŸèƒ½ä¸è´¨é‡',
                aiCollaboration: 'AIååŒèƒ½åŠ›',
                delivery: 'å…¨æµç¨‹äº¤ä»˜èƒ½åŠ›',
                learning: 'å­¦ä¹ èƒ½åŠ›ä¸åˆ›æ–°æ€§',
                documentation: 'æ–‡æ¡£è´¨é‡ï¼ˆåŠ åˆ†ï¼‰'
            };

            resultEl.innerHTML = `
                <div class="score-display">
                    <div class="score-number">${evaluation.totalScore}</div>
                    <div class="score-label">æ€»åˆ†</div>
                    <div style="margin-top: 10px; color: #4a5568;">${evaluation.summary}</div>
                </div>

                <div class="evaluation-section">
                    <h3>ğŸ“Š å„ç»´åº¦å¾—åˆ†</h3>
                    ${Object.entries(evaluation.dimensions).map(([key, dim]) => `
                        <div class="evaluation-item">
                            <div class="label">
                                ${dimensionNames[key]}
                                <span class="score">${dim.score}/${dim.maxScore}åˆ†</span>
                            </div>
                            <div class="comment">${dim.comment}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="evaluation-section">
                    <h3>âœ¨ ä¸»è¦ä¼˜åŠ¿</h3>
                    ${evaluation.strengths.map(s => `
                        <div class="evaluation-item">
                            <div class="comment">âœ“ ${s}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="evaluation-section">
                    <h3>ğŸ“ˆ æ”¹è¿›å»ºè®®</h3>
                    ${evaluation.improvements.map(i => `
                        <div class="evaluation-item">
                            <div class="comment">â€¢ ${i}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="evaluation-section">
                    <h3>ğŸ’¡ å‘å±•å»ºè®®</h3>
                    ${evaluation.suggestions.map(s => `
                        <div class="evaluation-item">
                            <div class="comment">${s}</div>
                        </div>
                    `).join('')}
                </div>

                <button class="save-btn" id="saveEvaluationBtn">
                    ğŸ’¾ ä¿å­˜è¯„ä¼°ç»“æœåˆ°æ•°æ®åº“
                </button>
            `;
            
            // ç»‘å®šä¿å­˜æŒ‰é’®äº‹ä»¶
            setTimeout(() => {
                const saveBtn = document.getElementById('saveEvaluationBtn');
                if (saveBtn) {
                    saveBtn.onclick = async function() {
                        await saveEvaluationHandler();
                    };
                }
            }, 100);
        }

        // ä¿å­˜è¯„ä¼°ç»“æœå¤„ç†å‡½æ•°
        async function saveEvaluationHandler() {
            console.log('ğŸ” saveEvaluationHandler è°ƒç”¨');
            console.log('ğŸ“‹ selectedCase:', selectedCase);
            console.log('ğŸ“Š currentEvaluation:', currentEvaluation);

            if (!selectedCase || !currentEvaluation) {
                alert('âŒ æ²¡æœ‰å¯ä¿å­˜çš„è¯„ä¼°ç»“æœ');
                return;
            }

            const saveBtn = document.getElementById('saveEvaluationBtn');
            if (!saveBtn) {
                console.error('âŒ æ‰¾ä¸åˆ°ä¿å­˜æŒ‰é’®å…ƒç´ ');
                return;
            }

            // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
            saveBtn.disabled = true;
            saveBtn.innerHTML = 'â³ ä¿å­˜ä¸­...';

            console.log('ğŸ’¾ å‡†å¤‡ä¿å­˜åˆ°æ•°æ®åº“...');
            console.log('ğŸ†” æ¡ˆä¾‹ID:', selectedCase.id);
            console.log('ğŸ“ˆ è¯„åˆ†:', currentEvaluation.totalScore);

            try {
                const updateData = {
                    score: currentEvaluation.totalScore,
                    feedback: JSON.stringify(currentEvaluation, null, 2),
                    status: 'reviewed',
                    reviewed_at: new Date().toISOString(),
                    reviewer: 'AIè¯„ä¼°ç³»ç»Ÿ'
                };

                console.log('ğŸ“¤ æ›´æ–°æ•°æ®:', updateData);

                const { data, error } = await caseSupabase
                    .from('case_submissions')
                    .update(updateData)
                    .eq('id', selectedCase.id)
                    .select(); // æ·»åŠ  select() ä»¥éªŒè¯æ›´æ–°

                console.log('ğŸ“¥ æ•°æ®åº“å“åº” - data:', data);
                console.log('ğŸ“¥ æ•°æ®åº“å“åº” - error:', error);

                if (error) {
                    console.error('âŒ æ•°æ®åº“é”™è¯¯:', error);
                    throw error;
                }

                if (!data || data.length === 0) {
                    console.warn('âš ï¸ æ²¡æœ‰æ•°æ®è¢«æ›´æ–°ï¼Œå¯èƒ½æ‰¾ä¸åˆ°å¯¹åº”çš„è®°å½•');
                    throw new Error('æœªæ‰¾åˆ°è¦æ›´æ–°çš„è®°å½•ï¼ˆID: ' + selectedCase.id + 'ï¼‰');
                }

                console.log('âœ… ä¿å­˜æˆåŠŸï¼');
                alert('âœ… è¯„ä¼°ç»“æœå·²æˆåŠŸä¿å­˜åˆ°æ•°æ®åº“ï¼');
                saveBtn.innerHTML = 'âœ“ å·²ä¿å­˜';
                saveBtn.style.background = '#48bb78';
                
                // æ›´æ–°æ¡ˆä¾‹åˆ—è¡¨ä¸­çš„çŠ¶æ€
                selectedCase.status = 'reviewed';
                selectedCase.score = currentEvaluation.totalScore;
                console.log('ğŸ”„ é‡æ–°åŠ è½½æ¡ˆä¾‹åˆ—è¡¨...');
                await loadCases(); // é‡æ–°åŠ è½½åˆ—è¡¨
                console.log('âœ… æ¡ˆä¾‹åˆ—è¡¨å·²åˆ·æ–°');
                
            } catch (error) {
                console.error('âŒ ä¿å­˜å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.message);
                console.error('é”™è¯¯å¯¹è±¡:', error);
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message + '\n\nè¯·æŒ‰ F12 æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯');
                saveBtn.disabled = false;
                saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜è¯„ä¼°ç»“æœåˆ°æ•°æ®åº“';
            }
        }

        // ä¿å­˜è¯„ä¼°ç»“æœï¼ˆæ—§å‡½æ•°ï¼Œä¿æŒå…¼å®¹ï¼‰
        async function saveEvaluation(score, evaluationJson) {
            if (!selectedCase) return;

            try {
                const evaluation = JSON.parse(evaluationJson);
                
                const { error } = await caseSupabase
                    .from('case_submissions')
                    .update({
                        score: score,
                        feedback: JSON.stringify(evaluation, null, 2),
                        status: 'reviewed',
                        reviewed_at: new Date().toISOString(),
                        reviewer: 'AIè¯„ä¼°ç³»ç»Ÿ'
                    })
                    .eq('id', selectedCase.id);

                if (error) throw error;

                alert('âœ… è¯„ä¼°ç»“æœå·²ä¿å­˜ï¼');
                
                // åˆ·æ–°æ¡ˆä¾‹åˆ—è¡¨
                await loadCases();
                
                // æ›´æ–°å½“å‰é€‰ä¸­çš„æ¡ˆä¾‹
                selectedCase.score = score;
                selectedCase.feedback = JSON.stringify(evaluation, null, 2);
                
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºå·²ä¿å­˜çš„è¯„ä¼°
        function showSavedEvaluation(caseData) {
            try {
                const evaluation = JSON.parse(caseData.feedback);
                displayEvaluation(evaluation);
                document.getElementById('evaluateBtn').textContent = 'ğŸ”„ é‡æ–°è¯„ä¼°';
            } catch (error) {
                console.error('è§£æè¯„ä¼°æ•°æ®å¤±è´¥:', error);
            }
        }
    </script>
</body>
</html>
