<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ½åŠ›è¯Šæ–­å™¨ - è®¤è¯†è‡ªæˆ‘</title>
    <link rel="stylesheet" href="style.css">
    <!-- PDF.jsåº“ç”¨äºè¯»å–PDFæ–‡ä»¶ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- AI API é…ç½® -->
    <script src="claude-api-config.js"></script>
    <script src="zhipu-api-config.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .hero {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 80px 20px 60px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
        }

        .container {
            max-width: 1000px;
            margin: -40px auto 60px;
            padding: 0 20px;
        }

        /* èƒ½åŠ›æ¨¡å‹å±•ç¤º */
        .competency-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .competency-section h2 {
            text-align: center;
            font-size: 2em;
            color: #1a202c;
            margin-bottom: 30px;
        }

        .competency-tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .competency-tab {
            padding: 12px 25px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .competency-tab:hover {
            border-color: #43e97b;
        }

        .competency-tab.active {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
            border-color: transparent;
        }

        .competency-content {
            display: none;
        }

        .competency-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .competency-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .competency-item {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #43e97b;
        }

        .competency-item h4 {
            color: #1a202c;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .competency-item p {
            color: #4a5568;
            font-size: 0.95em;
            line-height: 1.6;
        }

        /* ç®€å†ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .upload-section h2 {
            text-align: center;
            font-size: 2em;
            color: #1a202c;
            margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 15px;
            padding: 60px 20px;
            text-align: center;
            background: #f7fafc;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #43e97b;
            background: #f0fff4;
        }

        .upload-area.drag-over {
            border-color: #43e97b;
            background: #f0fff4;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #43e97b;
        }

        .upload-area p {
            color: #4a5568;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .upload-area small {
            color: #718096;
        }

        #fileInput {
            display: none;
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
            border-radius: 25px;
            font-weight: 600;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(67, 233, 123, 0.4);
        }

        /* è¯Šæ–­ç»“æœ */
        .result-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .result-section.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-header h2 {
            font-size: 2.2em;
            color: #1a202c;
            margin-bottom: 10px;
        }

        .overall-score {
            font-size: 4em;
            font-weight: bold;
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }

        .score-label {
            color: #4a5568;
            font-size: 1.2em;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        .result-card {
            background: #f7fafc;
            padding: 30px;
            border-radius: 15px;
        }

        .result-card h3 {
            color: #1a202c;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .strength-item, .improve-item {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .strength-item:last-child, .improve-item:last-child {
            border-bottom: none;
        }

        .strength-item::before {
            content: 'âœ“';
            color: #48bb78;
            font-weight: bold;
            margin-right: 10px;
        }

        .improve-item::before {
            content: 'â†’';
            color: #f6ad55;
            font-weight: bold;
            margin-right: 10px;
        }

        .suggestion-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }

        .suggestion-box h4 {
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .suggestion-box ul {
            list-style: none;
            padding: 0;
        }

        .suggestion-box li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
        }

        .suggestion-box li::before {
            content: 'ğŸ’¡';
            position: absolute;
            left: 0;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .cta-btn {
            padding: 15px 35px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: white;
        }

        .btn-secondary {
            background: white;
            color: #43e97b;
            border: 2px solid #43e97b;
        }

        .cta-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }

            .competency-list {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #43e97b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">è…¾è®¯HRÂ·èŒä¸šæˆé•¿ä¼™ä¼´</div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                <li><a href="cognition.html" class="nav-link">è®¤çŸ¥è…¾è®¯HR</a></li>
                <li><a href="diagnosis.html" class="nav-link active">èƒ½åŠ›è¯Šæ–­</a></li>
                <li><a href="application.html" class="nav-link">å·®å¼‚åŒ–ç”³è¯·</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero -->
    <div class="hero">
        <h1>ğŸ¯ èƒ½åŠ›è¯Šæ–­å™¨</h1>
        <p>äº†è§£ä½ çš„ä¼˜åŠ¿ï¼Œå‘ç°æå‡ç©ºé—´ï¼Œè·å¾—ä¸ªæ€§åŒ–æˆé•¿å»ºè®®</p>
    </div>

    <div class="container">
        <!-- èƒ½åŠ›æ¨¡å‹å±•ç¤º -->
        <div class="competency-section">
            <h2>ğŸ“Š è…¾è®¯HRèƒ½åŠ›è¦æ±‚</h2>
            <p style="text-align: center; color: #4a5568; margin-bottom: 30px;">åŸºäºæ²Ÿé€šå‹ã€åˆ†æå‹ã€åˆ›æ„å‹å²—ä½è¦æ±‚æ¢³ç†</p>

            <div class="competency-tabs">
                <div class="competency-tab active" onclick="switchCompetency('communication')">ğŸ’¬ æ²Ÿé€šå‹</div>
                <div class="competency-tab" onclick="switchCompetency('analysis')">ğŸ“Š åˆ†æå‹</div>
                <div class="competency-tab" onclick="switchCompetency('creative')">ğŸ¨ åˆ›æ„å‹</div>
            </div>

            <!-- æ²Ÿé€šå‹ -->
            <div id="comp-communication" class="competency-content active">
                <div class="competency-list">
                    <div class="competency-item">
                        <h4>äººé™…æ•æ„Ÿåº¦</h4>
                        <p>å¿«é€Ÿæ„ŸçŸ¥ä»–äººæƒ…ç»ªå’Œéœ€æ±‚ï¼Œå»ºç«‹ä¿¡ä»»å…³ç³»ï¼Œå–„äºå€¾å¬å’ŒåŒç†</p>
                    </div>
                    <div class="competency-item">
                        <h4>æ²Ÿé€šè¡¨è¾¾èƒ½åŠ›</h4>
                        <p>æ¸…æ™°å‡†ç¡®ä¼ è¾¾ä¿¡æ¯ï¼Œé€‚åº”ä¸åŒå¯¹è±¡è°ƒæ•´æ²Ÿé€šæ–¹å¼ï¼Œå–„äºè¯´æœå’Œå½±å“</p>
                    </div>
                    <div class="competency-item">
                        <h4>åè°ƒæ•´åˆèƒ½åŠ›</h4>
                        <p>å¹³è¡¡å¤šæ–¹éœ€æ±‚ï¼Œæ¨åŠ¨è·¨éƒ¨é—¨åä½œï¼Œè§£å†³å†²çªï¼Œè¾¾æˆå…±è¯†</p>
                    </div>
                    <div class="competency-item">
                        <h4>æœåŠ¡æ„è¯†</h4>
                        <p>ä»¥å€™é€‰äºº/å‘˜å·¥ä¸ºä¸­å¿ƒï¼Œæä¾›ä¼˜è´¨ä½“éªŒï¼Œä¸»åŠ¨å‘ç°å¹¶è§£å†³é—®é¢˜</p>
                    </div>
                    <div class="competency-item">
                        <h4>æƒ…ç»ªç®¡ç†</h4>
                        <p>ä¿æŒç§¯æå¿ƒæ€ï¼Œåº”å¯¹å‹åŠ›å’ŒæŒ«æŠ˜ï¼Œè¥é€ æ­£å‘æ°›å›´</p>
                    </div>
                    <div class="competency-item">
                        <h4>å½±å“åŠ›</h4>
                        <p>è·å¾—ä»–äººä¿¡ä»»ï¼Œæ¨åŠ¨å†³ç­–å’Œè¡ŒåŠ¨ï¼Œå»ºç«‹ä¸ªäººå“ç‰Œ</p>
                    </div>
                </div>
            </div>

            <!-- åˆ†æå‹ -->
            <div id="comp-analysis" class="competency-content">
                <div class="competency-list">
                    <div class="competency-item">
                        <h4>æ•°æ®åˆ†æèƒ½åŠ›</h4>
                        <p>æ”¶é›†ã€å¤„ç†å’Œåˆ†ææ‹›è˜æ•°æ®ï¼Œè¯†åˆ«è¶‹åŠ¿å’Œæ¨¡å¼ï¼Œåˆ¶ä½œå¯è§†åŒ–æŠ¥è¡¨</p>
                    </div>
                    <div class="competency-item">
                        <h4>é€»è¾‘æ€ç»´</h4>
                        <p>ç»“æ„åŒ–æ€è€ƒé—®é¢˜ï¼Œå»ºç«‹å› æœå…³ç³»ï¼Œæå‡ºåˆç†å‡è®¾å’ŒéªŒè¯</p>
                    </div>
                    <div class="competency-item">
                        <h4>é—®é¢˜è¯Šæ–­</h4>
                        <p>å¿«é€Ÿå®šä½é—®é¢˜æ ¹å› ï¼ŒåŒºåˆ†ç—‡çŠ¶å’Œæœ¬è´¨ï¼Œæå‡ºè§£å†³æ–¹æ¡ˆ</p>
                    </div>
                    <div class="competency-item">
                        <h4>ä¸šåŠ¡ç†è§£</h4>
                        <p>ç†è§£å…¬å¸æˆ˜ç•¥å’Œéƒ¨é—¨ç›®æ ‡ï¼Œå°†HRå·¥ä½œä¸ä¸šåŠ¡éœ€æ±‚ç»“åˆ</p>
                    </div>
                    <div class="competency-item">
                        <h4>æµç¨‹ä¼˜åŒ–</h4>
                        <p>å‘ç°æ•ˆç‡ç“¶é¢ˆï¼Œè®¾è®¡æ”¹è¿›æ–¹æ¡ˆï¼Œæ¨åŠ¨æµç¨‹æ ‡å‡†åŒ–</p>
                    </div>
                    <div class="competency-item">
                        <h4>å·¥å…·åº”ç”¨</h4>
                        <p>ç†Ÿç»ƒä½¿ç”¨Excelã€BIå·¥å…·ã€HRISç³»ç»Ÿï¼Œæ‹¥æŠ±æ–°æŠ€æœ¯</p>
                    </div>
                </div>
            </div>

            <!-- åˆ›æ„å‹ -->
            <div id="comp-creative" class="competency-content">
                <div class="competency-list">
                    <div class="competency-item">
                        <h4>åˆ›æ–°æ€ç»´</h4>
                        <p>è·³å‡ºå›ºæœ‰æ¡†æ¶ï¼Œæå‡ºæ–°é¢–æƒ³æ³•ï¼Œæ•¢äºå°è¯•å’Œå®éªŒ</p>
                    </div>
                    <div class="competency-item">
                        <h4>ç”¨æˆ·ä½“éªŒè®¾è®¡</h4>
                        <p>ä»å€™é€‰äºº/å‘˜å·¥è§†è§’è®¾è®¡æµç¨‹å’Œæ´»åŠ¨ï¼Œæ³¨é‡æ¯ä¸ªè§¦ç‚¹çš„ä½“éªŒ</p>
                    </div>
                    <div class="competency-item">
                        <h4>å†…å®¹ç­–åˆ’</h4>
                        <p>æ’°å†™å¸å¼•äººçš„æ–‡æ¡ˆï¼Œè®¾è®¡æœ‰è¶£çš„æ´»åŠ¨ï¼Œæ‰“é€ é›‡ä¸»å“ç‰Œ</p>
                    </div>
                    <div class="competency-item">
                        <h4>é¡¹ç›®æ‰§è¡Œ</h4>
                        <p>å°†åˆ›æ„è½¬åŒ–ä¸ºç°å®ï¼Œç»Ÿç­¹èµ„æºï¼ŒæŠŠæ§ç»†èŠ‚ï¼Œç¡®ä¿è½åœ°</p>
                    </div>
                    <div class="competency-item">
                        <h4>ç¾æ„Ÿä¸è®¾è®¡</h4>
                        <p>å…·å¤‡åŸºæœ¬å®¡ç¾èƒ½åŠ›ï¼Œæ‡‚å¾—è§†è§‰å‘ˆç°ï¼Œä½¿ç”¨è®¾è®¡å·¥å…·</p>
                    </div>
                    <div class="competency-item">
                        <h4>è¶‹åŠ¿æ´å¯Ÿ</h4>
                        <p>å…³æ³¨è¡Œä¸šåŠ¨æ€ï¼Œç†è§£Zä¸–ä»£ç‰¹å¾ï¼ŒæŠŠæ¡æ½®æµè¶‹åŠ¿</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç®€å†ä¸Šä¼  -->
        <div class="upload-section">
            <h2>ğŸ“¤ ä¸Šä¼ ç®€å†ï¼Œå¼€å§‹è¯Šæ–­</h2>
            <p style="text-align: center; color: #4a5568; margin-bottom: 30px;">
                æˆ‘ä»¬å°†åŸºäºè…¾è®¯HRèƒ½åŠ›æ¨¡å‹ï¼Œæ™ºèƒ½åˆ†æä½ çš„ç®€å†<br>
                ç»™å‡ºä¼˜åŠ¿åˆ†æå’Œæå‡å»ºè®®
            </p>

            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ğŸ“„</div>
                <p><strong>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</strong> æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ</p>
                <small>æ”¯æŒ PDFã€Wordã€TXT æ ¼å¼ï¼Œæœ€å¤§ 5MB</small>
                <div class="upload-btn" style="margin-top: 20px;">é€‰æ‹©æ–‡ä»¶</div>
            </div>

            <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" onchange="handleFileSelect(event)">

            <p style="text-align: center; margin-top: 20px; color: #718096; font-size: 0.9em;">
                ğŸ”’ ä½ çš„ç®€å†ä¿¡æ¯å°†è¢«åŠ å¯†å¤„ç†ï¼Œä»…ç”¨äºèƒ½åŠ›è¯Šæ–­ï¼Œä¸ä¼šæ³„éœ²ç»™ç¬¬ä¸‰æ–¹
            </p>
        </div>

        <!-- åŠ è½½ä¸­ -->
        <div class="loading" id="loadingSection">
            <div class="spinner"></div>
            <p style="color: #4a5568; font-size: 1.1em;">æ­£åœ¨åˆ†æä½ çš„ç®€å†ï¼Œè¯·ç¨å€™...</p>
        </div>

        <!-- è¯Šæ–­ç»“æœ -->
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2>ğŸ“Š ä½ çš„èƒ½åŠ›è¯Šæ–­æŠ¥å‘Š</h2>
                <div class="overall-score" id="overallScore">85</div>
                <div class="score-label">ç»¼åˆåŒ¹é…åº¦</div>
                <p style="color: #4a5568; margin-top: 15px;">åŸºäº<span id="analysisBasis" style="font-weight: bold; color: #43e97b;">æ²Ÿé€šå‹</span>å²—ä½è¦æ±‚åˆ†æ</p>
            </div>

            <div class="result-grid">
                <div class="result-card" style="background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);">
                    <h3>âœ… ä½ çš„ä¼˜åŠ¿</h3>
                    <div id="strengthsList"></div>
                </div>

                <div class="result-card" style="background: linear-gradient(135deg, #fffaf0 0%, #ffffff 100%);">
                    <h3>ğŸ“ˆ éœ€è¦æå‡</h3>
                    <div id="improveList"></div>
                </div>
            </div>

            <div class="suggestion-box">
                <h4>ğŸ’¡ ä¸ªæ€§åŒ–æˆé•¿å»ºè®®</h4>
                <ul id="suggestionsList"></ul>
            </div>

            <div class="cta-buttons">
                <a href="application.html" class="cta-btn btn-primary">å‚ä¸æ¡ˆä¾‹æŒ‘æˆ˜ â†’</a>
                <a href="cognition.html" class="cta-btn btn-secondary">äº†è§£æ›´å¤šHRå·¥ä½œ</a>
            </div>
        </div>
    </div>

    <script>
        // Tabåˆ‡æ¢
        function switchCompetency(type) {
            document.querySelectorAll('.competency-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.competency-tab').forEach(el => el.classList.remove('active'));
            
            document.getElementById('comp-' + type).classList.add('active');
            event.target.classList.add('active');
        }

        // æ–‡ä»¶æ‹–æ‹½
        const uploadArea = document.getElementById('uploadArea');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.add('drag-over');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.remove('drag-over');
            });
        });

        uploadArea.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loadingSection').classList.add('show');
            
            // æ ¹æ®æ–‡ä»¶ç±»å‹è¯»å–å†…å®¹
            if (file.type === 'text/plain') {
                // TXTæ–‡ä»¶ç›´æ¥è¯»å–
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const resumeText = e.target.result;
                    await analyzeResumeWithAI(resumeText, file.name);
                };
                reader.readAsText(file);
            } else if (file.type === 'application/pdf') {
                // PDFæ–‡ä»¶ä½¿ç”¨PDF.jsè¯»å–
                extractPDFText(file);
            } else {
                // Wordç­‰å…¶ä»–æ ¼å¼ï¼Œæå–æ–‡ä»¶åä¿¡æ¯
                analyzeResumeWithAI('ç®€å†æ–‡ä»¶ï¼š' + file.name, file.name);
            }
        }

        async function extractPDFText(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument({data: arrayBuffer});
                const pdf = await loadingTask.promise;
                
                let fullText = '';
                
                // è¯»å–æ‰€æœ‰é¡µé¢
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }
                
                await analyzeResumeWithAI(fullText, file.name);
            } catch (error) {
                console.error('PDFè¯»å–å¤±è´¥:', error);
                // é™çº§å¤„ç†
                await analyzeResumeWithAI('PDFç®€å†ï¼š' + file.name, file.name);
            }
        }

        async function analyzeResumeWithAI(resumeText, fileName) {
            try {
                // ä¼˜å…ˆçº§1: åç«¯APIï¼ˆçº¿ä¸Šéƒ¨ç½²æ¨èï¼ŒAPI Keyå®‰å…¨ï¼‰
                try {
                    console.log('ğŸš€ å°è¯•è°ƒç”¨åç«¯APIåˆ†æ...');
                    const result = await analyzeWithBackendAPI(resumeText, fileName);
                    if (result) {
                        displayResult(result);
                        return;
                    }
                } catch (backendError) {
                    console.warn('âš ï¸ åç«¯APIä¸å¯ç”¨ï¼Œå°è¯•å…¶ä»–æ–¹æ¡ˆ:', backendError.message);
                    // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ¡ˆ
                }
                
                // ä¼˜å…ˆçº§2: æ™ºè°±AIï¼ˆæœ¬åœ°å¼€å‘ï¼Œéœ€è¦é…ç½®API Keyï¼‰
                if (typeof ZHIPU_CONFIG !== 'undefined' && 
                    ZHIPU_CONFIG.apiKey && 
                    ZHIPU_CONFIG.apiKey !== 'your-zhipu-api-key-here') {
                    
                    console.log('âœ… ä½¿ç”¨æ™ºè°±AIè¿›è¡ŒçœŸå®AIåˆ†æ...');
                    
                    try {
                        const result = await analyzeWithZhipuRetry(resumeText, fileName);
                        displayResult(result);
                        return;
                    } catch (zhipuError) {
                        console.error('æ™ºè°±AIå¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹æ¡ˆ:', zhipuError);
                        // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ¡ˆ
                    }
                }
                
                // ä¼˜å…ˆçº§3: Claude APIï¼ˆå¦‚æœé…ç½®äº†API Keyï¼‰
                if (typeof CLAUDE_CONFIG !== 'undefined' && 
                    CLAUDE_CONFIG.apiKey && 
                    CLAUDE_CONFIG.apiKey !== 'sk-ant-api03-your-api-key-here') {
                    
                    console.log('ä½¿ç”¨ Claude API è¿›è¡ŒçœŸå®AIåˆ†æ...');
                    
                    try {
                        const result = await analyzeWithClaudeRetry(resumeText, fileName);
                        displayResult(result);
                        return;
                    } catch (claudeError) {
                        console.error('Claude API å¤±è´¥ï¼Œé™çº§åˆ°æ™ºèƒ½åˆ†æ:', claudeError);
                        // ç»§ç»­æ‰§è¡Œé™çº§é€»è¾‘
                    }
                }
                
                // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨æ™ºèƒ½å…³é”®è¯åˆ†æ
                console.log('ä½¿ç”¨æ™ºèƒ½å…³é”®è¯åˆ†æ...');
                generateSmartMockResult(resumeText, fileName);
                
            } catch (error) {
                console.error('åˆ†æé”™è¯¯:', error);
                alert('åˆ†æè¿‡ç¨‹å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                document.getElementById('loadingSection').classList.remove('show');
            }
        }

        // åç«¯APIåˆ†æå‡½æ•°ï¼ˆæ¨èç”¨äºçº¿ä¸Šéƒ¨ç½²ï¼‰
        async function analyzeWithBackendAPI(resumeText, fileName) {
            try {
                // æ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‰æ‹©APIåœ°å€
                const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                    ? 'http://localhost:3000'  // æœ¬åœ°å¼€å‘
                    : '';  // ç”Ÿäº§ç¯å¢ƒï¼ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
                
                const response = await fetch(`${API_BASE}/api/analyze-resume`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        resumeText,
                        fileName
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || `åç«¯APIé”™è¯¯: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'åç«¯APIè¿”å›å¤±è´¥');
                }

                console.log('âœ… åç«¯APIåˆ†ææˆåŠŸï¼');
                return data.data;

            } catch (error) {
                console.error('âŒ åç«¯APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }

        function generateSmartMockResult(resumeText, fileName) {
            // åŸºäºç®€å†å†…å®¹è¿›è¡Œæ™ºèƒ½åˆ†æ
            const text = (resumeText + ' ' + fileName).toLowerCase();
            
            // å…³é”®è¯åˆ†æ
            const keywords = {
                data: ['æ•°æ®', 'åˆ†æ', 'excel', 'sql', 'python', 'tableau', 'ç»Ÿè®¡', 'æŠ¥è¡¨', 'data'],
                communication: ['æ´»åŠ¨', 'ç»„ç»‡', 'ç¤¾å›¢', 'å¿—æ„¿', 'ä¸»å¸­', 'éƒ¨é•¿', 'ç­–åˆ’', 'åè°ƒ', 'æ²Ÿé€š', 'leader'],
                creative: ['è®¾è®¡', 'åˆ›æ„', 'æ–°åª’ä½“', 'æ–‡æ¡ˆ', 'è§†é¢‘', 'è¿è¥', 'å“ç‰Œ', 'è¥é”€', 'creative']
            };
            
            // è®¡ç®—å„ç»´åº¦å¾—åˆ†
            let scores = {
                data: 0,
                communication: 0,
                creative: 0
            };
            
            for (let key in keywords) {
                keywords[key].forEach(word => {
                    if (text.includes(word)) {
                        scores[key] += 1;
                    }
                });
            }
            
            // ç¡®å®šå²—ä½ç±»å‹
            let type = 'æ²Ÿé€šå‹';
            let maxScore = scores.communication;
            let baseScore = 75;
            
            if (scores.data > maxScore) {
                type = 'åˆ†æå‹';
                maxScore = scores.data;
                baseScore = 82;
            } else if (scores.creative > scores.communication && scores.creative > scores.data) {
                type = 'åˆ›æ„å‹';
                maxScore = scores.creative;
                baseScore = 78;
            } else if (scores.communication > 0) {
                baseScore = 85;
            }
            
            // æ ¹æ®å…³é”®è¯æ•°é‡è°ƒæ•´åˆ†æ•°
            const finalScore = Math.min(95, baseScore + maxScore * 2);
            
            // ç”Ÿæˆå…·ä½“çš„åˆ†æç»“æœ
            const result = {
                score: finalScore,
                type: type,
                strengths: generateStrengths(type, text),
                improvements: generateImprovements(type, scores),
                suggestions: generateSuggestions(type)
            };
            
            displayResult(result);
        }

        function generateStrengths(type, text) {
            const baseStrengths = {
                'æ²Ÿé€šå‹': [
                    'å…·å¤‡ä¸°å¯Œçš„å›¢é˜Ÿåä½œå’Œæ´»åŠ¨ç»„ç»‡ç»éªŒ',
                    'å±•ç°å‡ºè‰¯å¥½çš„æ²Ÿé€šåè°ƒèƒ½åŠ›',
                    'æœ‰é¢†å¯¼åŠ›å’Œå›¢é˜Ÿç®¡ç†ç»éªŒ',
                    'æœåŠ¡æ„è¯†å¼ºï¼Œå…·å¤‡åŒç†å¿ƒ'
                ],
                'åˆ†æå‹': [
                    'å…·å¤‡æ‰å®çš„æ•°æ®åˆ†æèƒ½åŠ›',
                    'é€»è¾‘æ€ç»´æ¸…æ™°ï¼Œå–„äºå‘ç°é—®é¢˜',
                    'ç†Ÿç»ƒæŒæ¡åˆ†æå·¥å…·å’Œæ–¹æ³•',
                    'æœ‰æ•°æ®é©±åŠ¨å†³ç­–çš„æ„è¯†'
                ],
                'åˆ›æ„å‹': [
                    'åˆ›æ„æ€ç»´æ´»è·ƒï¼Œæƒ³æ³•æ–°é¢–',
                    'æœ‰ä¸°å¯Œçš„å†…å®¹åˆ›ä½œç»éªŒ',
                    'æ“…é•¿å“ç‰Œä¼ æ’­å’Œè¿è¥',
                    'å¯¹æ–°åª’ä½“å’Œè¶‹åŠ¿æ•æ„Ÿ'
                ]
            };
            
            let strengths = baseStrengths[type] || baseStrengths['æ²Ÿé€šå‹'];
            
            // æ·»åŠ ç®€å†ç»“æ„ç›¸å…³çš„ä¼˜åŠ¿
            if (text.length > 100) {
                strengths[0] = 'ç®€å†å†…å®¹ä¸°å¯Œï¼Œå……åˆ†å±•ç¤ºäº†' + (type === 'åˆ†æå‹' ? 'æ•°æ®åˆ†æ' : type === 'åˆ›æ„å‹' ? 'åˆ›æ„ç­–åˆ’' : 'å›¢é˜Ÿåä½œ') + 'èƒ½åŠ›';
            }
            
            return strengths;
        }

        function generateImprovements(type, scores) {
            const improvements = [];
            
            if (type !== 'åˆ†æå‹' && scores.data < 2) {
                improvements.push('å»ºè®®è¡¥å……æ•°æ®åˆ†æç›¸å…³ç»éªŒï¼Œå­¦ä¹ Excelæˆ–Python');
            }
            
            if (type !== 'æ²Ÿé€šå‹' && scores.communication < 2) {
                improvements.push('å»ºè®®å¢åŠ å›¢é˜Ÿåä½œå’Œæ´»åŠ¨ç»„ç»‡ç»å†');
            }
            
            if (type !== 'åˆ›æ„å‹' && scores.creative < 2) {
                improvements.push('å¯ä»¥å°è¯•å‚ä¸åˆ›æ„ç±»é¡¹ç›®ï¼ŒåŸ¹å…»åˆ›æ–°æ€ç»´');
            }
            
            improvements.push('å»ºè®®ç³»ç»Ÿå­¦ä¹ HRä¸“ä¸šçŸ¥è¯†ï¼Œäº†è§£è¡Œä¸šè¶‹åŠ¿');
            
            // ç¡®ä¿è‡³å°‘æœ‰4æ¡å»ºè®®
            while (improvements.length < 4) {
                const general = [
                    'ç®€å†ä¸­å¯ä»¥é‡åŒ–æ›´å¤šæˆæœæ•°æ®ï¼ˆå¦‚ï¼šæå‡XX%ï¼Œå®ŒæˆXXäººç­‰ï¼‰',
                    'å»ºè®®å‚åŠ æ›´å¤šå•†ä¸šå®è·µé¡¹ç›®ï¼Œå¢åŠ å®æˆ˜ç»éªŒ',
                    'å¯ä»¥å¢åŠ HRç›¸å…³çš„å®ä¹ æˆ–å¿—æ„¿è€…ç»å†',
                    'å»ºè®®å­¦ä¹ HRBPã€ODç­‰HRä¸“ä¸šé¢†åŸŸçŸ¥è¯†'
                ];
                improvements.push(general[improvements.length]);
            }
            
            return improvements.slice(0, 4);
        }

        function generateSuggestions(type) {
            const baseSuggestions = [
                'å‚åŠ è…¾è®¯HRæ¡ˆä¾‹æŒ‘æˆ˜ï¼Œæ·±åº¦äº†è§£çœŸå®ä¸šåŠ¡åœºæ™¯',
                'å…³æ³¨"è…¾è®¯HRæ‹›è˜"å’Œ"è…¾è®¯å­¦å ‚"å…¬ä¼—å·ï¼Œäº†è§£è¡Œä¸šåŠ¨æ€'
            ];
            
            if (type === 'åˆ†æå‹') {
                baseSuggestions.push('æ·±åŒ–æ•°æ®åˆ†æèƒ½åŠ›ï¼Œå­¦ä¹ Pythonã€SQLã€æ•°æ®å¯è§†åŒ–');
                baseSuggestions.push('é˜…è¯»æ¨èï¼šã€Šæ•°æ®é©±åŠ¨çš„äººåŠ›èµ„æºç®¡ç†ã€‹ã€Šç²¾ç›Šæ•°æ®åˆ†æã€‹');
            } else if (type === 'åˆ›æ„å‹') {
                baseSuggestions.push('æå‡æ–°åª’ä½“è¿è¥èƒ½åŠ›ï¼Œå­¦ä¹ å†…å®¹åˆ›ä½œå’Œå“ç‰Œä¼ æ’­');
                baseSuggestions.push('é˜…è¯»æ¨èï¼šã€Šå½±å“åŠ›ã€‹ã€Šå®šä½ã€‹ã€Šåˆ›æ„çš„ç”Ÿæˆã€‹');
            } else {
                baseSuggestions.push('å­¦ä¹ Excelæ•°æ®åˆ†æå’Œå¯è§†åŒ–ï¼Œè¡¥å……åˆ†æèƒ½åŠ›');
                baseSuggestions.push('é˜…è¯»æ¨èï¼šã€Šäººæ‰æ‹›è˜ä¸é€‰æ‹”ã€‹ã€Šç»„ç»‡è¡Œä¸ºå­¦ã€‹');
            }
            
            baseSuggestions.push('è€ƒè™‘å‚åŠ SHRMã€HRBPç­‰HRä¸“ä¸šè®¤è¯è¯¾ç¨‹');
            
            return baseSuggestions;
        }

        function displayResult(result) {
            // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºç»“æœ
            document.getElementById('loadingSection').classList.remove('show');
            document.getElementById('resultSection').classList.add('show');

            // æ¸²æŸ“ç»“æœ
            document.getElementById('overallScore').textContent = result.score;
            document.getElementById('analysisBasis').textContent = result.type;

            // æ¸²æŸ“ä¼˜åŠ¿
            const strengthsHTML = result.strengths.map(item => 
                `<div class="strength-item">${item}</div>`
            ).join('');
            document.getElementById('strengthsList').innerHTML = strengthsHTML;

            // æ¸²æŸ“éœ€æå‡
            const improvementsHTML = result.improvements.map(item => 
                `<div class="improve-item">${item}</div>`
            ).join('');
            document.getElementById('improveList').innerHTML = improvementsHTML;

            // æ¸²æŸ“å»ºè®®
            const suggestionsHTML = result.suggestions.map(item => 
                `<li>${item}</li>`
            ).join('');
            document.getElementById('suggestionsList').innerHTML = suggestionsHTML;

            // æ»šåŠ¨åˆ°ç»“æœ
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function analyzeResume(file) {
            // è¿™ä¸ªå‡½æ•°ä¿ç•™ä½œä¸ºå¤‡ç”¨
            displayResult({
                score: 85,
                type: 'æ²Ÿé€šå‹',
                strengths: [
                    'å…·å¤‡ä¸°å¯Œçš„å­¦ç”Ÿç»„ç»‡ç»å†ï¼Œä½“ç°å‡ºè‰²çš„æ²Ÿé€šåè°ƒèƒ½åŠ›',
                    'å¤šæ¬¡ç­–åˆ’å¤§å‹æ´»åŠ¨ï¼Œå±•ç°é¡¹ç›®ç®¡ç†å’Œå›¢é˜Ÿåä½œèƒ½åŠ›',
                    'å¿—æ„¿è€…ç»å†ä¸°å¯Œï¼Œå…·å¤‡è‰¯å¥½çš„æœåŠ¡æ„è¯†',
                    'ç¤¾å›¢è´Ÿè´£äººç»å†ä½“ç°leadershipå’Œå½±å“åŠ›'
                ],
                improvements: [
                    'ç¼ºå°‘æ•°æ®åˆ†æç›¸å…³ç»éªŒï¼Œå»ºè®®è¡¥å……æ•°æ®å¤„ç†é¡¹ç›®',
                    'å¯¹HRä¸“ä¸šçŸ¥è¯†çš„å­¦ä¹ è¾ƒå°‘ï¼Œå»ºè®®ç³»ç»Ÿå­¦ä¹ HRçŸ¥è¯†',
                    'ç¼ºå°‘å•†ä¸šå®è·µç»éªŒï¼Œå¯å‚åŠ å•†ä¸šæ¡ˆä¾‹å¤§èµ›',
                    'ç®€å†ä¸­æœªä½“ç°å¯¹æ–°æŠ€æœ¯çš„åº”ç”¨ï¼Œå»ºè®®å­¦ä¹ HR Techå·¥å…·'
                ],
                suggestions: [
                    'å‚åŠ è…¾è®¯HRæ¡ˆä¾‹æŒ‘æˆ˜ï¼Œæ·±åº¦äº†è§£çœŸå®ä¸šåŠ¡åœºæ™¯',
                    'å­¦ä¹ Excel/Pythonæ•°æ®åˆ†æï¼Œè¡¥å……åˆ†æèƒ½åŠ›',
                    'é˜…è¯»æ¨èä¹¦ç±ï¼šã€Šäººæ‰æ‹›è˜ä¸é€‰æ‹”ã€‹ã€Šæ•°æ®åŒ–ç®¡ç†ã€‹',
                    'å…³æ³¨"è…¾è®¯HRæ‹›è˜"å…¬ä¼—å·ï¼Œäº†è§£è¡Œä¸šåŠ¨æ€',
                    'å‚åŠ SHRM/ATDç­‰HRä¸“ä¸šè®¤è¯è¯¾ç¨‹'
                ]
            });
        }
    </script>
</body>
</html>
